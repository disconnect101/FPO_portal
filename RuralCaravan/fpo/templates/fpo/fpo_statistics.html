{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>Statistics</title>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.11.2/css/all.css">
    <!-- Bootstrap core CSS -->
    <link href="{% static 'css/bootstrap.min.css' %}" rel="stylesheet">
    <!-- Material Design Bootstrap -->
    <link href="{% static 'css/mdb.min.css' %}" rel="stylesheet">
    <!--  custom styles  -->
    <link href="{% static 'css/style.min.css' %}" rel="stylesheet">
    <!-- Charts Js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.min.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.min.css" crossorigin="anonymous"></link>
    <style type="text/css">

      html,
      body,
      header,
      .carousel {
        height: 60vh;
      }

      @media (max-width: 740px) {
        html,
        body,
        header,
        .carousel {
          height: 100vh;
        }
      }

      @media (min-width: 800px) and (max-width: 850px) {
        html,
        body,
        header,
        .carousel {
          height: 100vh;
        }
      }

      @media (min-width: 800px) and (max-width: 850px) {
              .navbar:not(.top-nav-collapse) {
                  background:#295e10!important;
              }
          }

      input.rsvp {
        background-color: #4caf50;
        width: 14px;
        height: 14px;
      }

      #pushButton {
        background-color: white;
        border: 1px solid #d62828;
        color: #d62828;
        border-radius: 0.2rem;
        font-size: 1.4rem;
        padding: 0.2rem 1rem;
        transition: all 0.5s;
      }

      #pushButton:hover {
        background-color: #d62828;
        border: 1px solid white;
        color: white;
      }

      #pushButton:focus, #pushButton:active, #pushButton:selected {
        border: 1px solid #d62828;
      }

      input.selectAll {
        width: 16px;
        height: 16px;
      }

      .card {
        cursor: pointer;
      }

      option:hover, option:checked {
          background-color: #4caf50 !important;
          color: white !important;
      }

      option:active {
          border: 1px solid #4caf50;
      }

.counter-box {
    display: block;
    background: #f6f6f6;
    padding: 40px 20px 37px;
    text-align: center
}

.counter-box p {
    margin: 5px 0 0;
    padding: 0;
    color: #909090;
    font-size: 18px;
    font-weight: 500
}

.counter-box i {
    font-size: 60px;
    margin: 0 0 15px;
    color: #d2d2d2
}

.counter {
    display: block;
    font-size: 32px;
    font-weight: 700;
    color: #666;
    line-height: 28px
}
.profit{
    display: block;
    font-size: 32px;
    font-weight: 700;
    color: #666;
    line-height: 28px

}

.counter-box.colored {
    background: #3acf87
}

.counter-box.colored p,
.counter-box.colored i,
.counter-box.colored .counter {
    color: #fff
}

    </style>
</head>

<body>

  <!-- Navbar -->
 <nav class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar">
    <div class="container">

      <!-- Brand -->
      <a class="navbar-brand" href="{% url 'home' %}">
        <strong>FPO PORTAL</strong>
      </a>

      <!-- Collapse -->
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
        aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>

      <!-- Links -->
      <div class="collapse navbar-collapse" id="navbarSupportedContent">

        <!-- Left -->
        <ul class="navbar-nav mr-auto">
          <li class="nav-item">
            <a class="nav-link" href="{% url 'home' %}">Home
              <span class="sr-only">(current)</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="{% url 'meetings' %}" >Meetings</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="{% url 'plans' %}">Plans</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="{% url 'govtschemes' %}" >Government Schemes</a>
          </li>
             <li class="nav-item">
            <a class="nav-link" href="{% url 'produce' %}" >Production</a>
          </li>
            <li class="nav-item">
                <a class="nav-link" href="{% url 'FPOLedger'%}">Ledger</a>
            </li>
        </ul>

        <!-- Right -->
        <ul class="navbar-nav nav-flex-icons">
            <li class="nav-item">
            <a href="{% url 'add_user' %}" class="nav-link" data-toggle="tooltip" title="Add New User">
             <i class="fas fa-user-plus"></i>
            </a>
          </li>
             <li class="nav-item">
            <a href="{% url 'transaction'%}" class="nav-link" data-toggle="tooltip" title="Transactions">
             <i class="fas fa-rupee-sign"></i>
            </a>
          </li>
          <li class="nav-item">
            <a href="{% url 'orders' %}" class="nav-link" data-toggle="tooltip" title="Orders">
             <i class="fas fa-shopping-cart"></i>
            </a>
          </li>
             <li class="nav-item">
            <a href="{% url 'products' %}" class="nav-link" data-toggle="tooltip" title="Products">
             <i class="fas fa-shopping-basket"></i>
            </a>
          </li>
          <li class="nav-item active">
            <a href="{% url 'fpo_statistics' %}" class="nav-link" data-toggle="tooltip" title="Statistics">
             <i class="fas fa-chart-bar"></i>
            </a>
          </li>
          <li class="nav-item">
            <a href="{% url 'members' %}" class="nav-link border border-light rounded"
             >
              <i class="fas fa-user"></i>Members
            </a>
          </li>
		  <li class="nav-item">
            <a class="nav-link" href="{% url 'login' %}" >Logout</a>
          </li>


        </ul>

      </div>

    </div>
  </nav>
  <!-- Navbar -->



  <!--Main layout-->
<main style="padding-top:8rem;">
    <div class="container" >
        <div class="row">
            <div class="col-12">


                <h1 style="text-align: center;" class="green-text mt-0 mb-3">The Organisation at a Glance</h1>
                <hr style="margin: auto; width: 6rem; border: 2px solid #4caf50; border-radius: 20rem;">
                <br>
            </div>
        </div>
         <div class="row" style="margin: 4rem auto;">
        <div class="four col-md-3">
            <div class="counter-box colored"> <i class="fas fa-users"></i> <span class="counter">{{num_farmers}}</span>
                <p>FARMERS</p>
            </div>
        </div>
        <div class="four col-md-3">
            <div class="counter-box colored"> <i class="fas fa-home"></i> <span class="counter">{{num_villages}}</span>
                <p>VILLAGES</p>
            </div>
        </div>
        <div class="four col-md-3">
            <div class="counter-box colored"> <i class="fas fa-weight-hanging"></i> <span class="counter">{{avg_production}}</span>
                <p>QT. PRODUCTION</p>
            </div>
        </div>
             <div class="four col-md-3">
            <div class="counter-box colored"> <i class="fas fa-money-bill"></i> <span class="profit" style="color:white;">₹ {{avg_profits}}</span>
                <p>PROFITS</p>
            </div>
        </div>

    </div>




        <div class="row" style="margin-top: 4rem;">
            <div class="col-6">
                <h1 style="text-align: center;" class="green-text mb-4">Communcation Channels</h1>
                <hr class="mb-4" style="width: 6rem; border: 2px solid #4caf50; border-radius: 20rem;">
                <canvas id="communicationChannel" width="100" height="100"></canvas>
            </div>
            <div class="col-6">
                <h1 style="text-align: center;" class="green-text mb-4">Farmers with Leaders</h1>
                <hr class="mb-4" style="width: 6rem; border: 2px solid #4caf50; border-radius: 20rem;">
                <canvas id="farmersWithLeaders" width="100" height="100"></canvas>
            </div>
        </div>
         <div class="row" style="margin-top: 4rem;">
            <div class="col-1"></div>
            <div class="col-10 mt-4">
                <h1 style="text-align: center;" class="green-text">Engagement Of Farmers</h1>
                <hr class="mb-2" style="width: 6rem; border: 2px solid #4caf50; border-radius: 20rem;">
                <canvas id="farmerEngagement" width="100" height="60"></canvas>
            </div>
        </div>
        <div class="row" style="margin-top: 4rem;">
            <div class="col-6 mt-4">
                <h1 style="text-align: center;" class="green-text">Farmers Per Village</h1>
                <hr class="mb-4" style="width: 6rem; border: 2px solid #4caf50; border-radius: 20rem;">
                <canvas id="villages" width="100" height="100"></canvas>
            </div>
            <div class="col-6 mt-4">
                <h1 style="text-align: center;" class="green-text">Production Per Crop</h1>
                <hr class="mb-4" style="width: 6rem; border: 2px solid #4caf50; border-radius: 20rem;">
                <canvas id="crops" width="100" height="100"></canvas>
            </div>
        </div>
        <div class="row" style="margin-top: 4rem;">
            <div class="col-6 mt-4">
                <h1 style="text-align: center;" class="green-text">Production By Crop</h1>
                <hr class="mb-4" style="width: 6rem; border: 2px solid #4caf50; border-radius: 20rem;">
                <div class="form-group">
                    <label for="cropSelector" style="color: #4caf50;"><strong>Select Crop</strong></label>
                    <select class="form-control" style="border: 1px solid #4caf50; color: #4caf50;" id="cropSelector">
                        {% for option in crop_selector_options %}
                        <option style="color: #4caf50;">{{option}}</option>
                        {% endfor %}
                    </select>
                </div>
                <canvas id="productionByCrop" width="100" height="100"></canvas>
            </div>
            <div class="col-6 mt-4">
                <h1 style="text-align: center;" class="green-text">Amount Per Crop</h1>
                <hr class="mb-4" style="width: 6rem; border: 2px solid #4caf50; border-radius: 20rem;">
                <div class="form-group">
                    <label for="cropPriceSelector" style="color: #4caf50;"><strong>Select Crop</strong></label>
                    <select class="form-control" style="border: 1px solid #4caf50; color: #4caf50;" id="cropPriceSelector">
                        {% for option in crop_price_selector_options %}
                        <option style="color: #4caf50;">{{option}}</option>
                        {% endfor %}
                    </select>
                </div>
                <canvas id="amountPerCrop" width="100" height="100"></canvas>
            </div>
        </div>
        <div class="row" style="margin-top: 4rem;">
            <div class="col-1"></div>
            <div class="col-10 mt-4">
                <h1 style="text-align: center;" class="green-text">Profits By Year</h1>
                <hr class="mb-2" style="width: 6rem; border: 2px solid #4caf50; border-radius: 20rem;">
                <div class="form-group">
                    <label for="yearSelector" style="color: #4caf50;"><strong>Select Year</strong></label>
                    <select class="form-control" style="border: 1px solid #4caf50; color: #4caf50;" id="yearSelector">
                        {% for option in year_selector_options %}
                        <option style="color: #4caf50">{{option}}</option>
                        {% endfor %}
                    </select>
                </div>
                <canvas id="profitsByYear" width="100" height="60"></canvas>
            </div>
        </div>
    </div>
    
</main>
  <!--Main layout-->

  <!--Footer-->
  <footer class="page-footer text-center font-small mt-4 wow fadeIn" >



    <!--Copyright-->
    <div class="footer-copyright py-3">
      © 2020 Copyright:
  Rural Caravan
    </div>
    <!--/.Copyright-->

  </footer>
  <!--/.Footer-->

    <!-- SCRIPTS -->
    <!-- JQuery -->
    <script type="text/javascript" src="{% static 'js/jquery-3.4.1.min.js' %}"></script>
    <!-- Bootstrap tooltips -->
    <script type="text/javascript" src="{% static 'js/popper.min.js' %}"></script>
    <!-- Bootstrap core JavaScript -->
    <script type="text/javascript" src="{% static 'js/bootstrap.min.js' %}"></script>
    <!-- MDB core JavaScript -->
    <script type="text/javascript" src="{% static 'js/mdb.min.js' %}"></script>
      <!-- Initializations -->
  <script type="text/javascript">
    // Animations initialization
    //new WOW().init();

    //Javascript for Graphs and Rendering

    // Communication Channels for the farmers

    var communicationChannelsData = {{ communication_channels_data|safe }};
    var communicationChannelsLabels = {{ communication_channels_labels|safe }};

    var ctxCommunicationChannel = document.getElementById('communicationChannel').getContext('2d');
    var communicationChannel = new Chart(ctxCommunicationChannel, {
        type: 'pie',
        data: {
            datasets: [{
                data: communicationChannelsData,
                backgroundColor: [
                'rgba(255, 206, 86, 0.4)',
                'rgba(78, 205, 196, 0.4)',
                'rgba(255, 107, 107, 0.4)',
                ],
                borderColor: [
                'rgba(255, 206, 86, 1)',
                'rgba(78, 205, 196, 1)',
                'rgba(255, 107, 107, 1)',
                ] 
            }],
            labels: communicationChannelsLabels
        },
        options: {}
    });

    // Farmers with Leaders
    var farmersWithLeadersData = {{ farmers_with_leaders_data|safe }};

    var ctxFarmersWithLeaders = document.getElementById('farmersWithLeaders').getContext('2d');
    var farmersWithLeaders = new Chart(ctxFarmersWithLeaders, {
        type: 'pie',
        data: {
            datasets: [{
                data: farmersWithLeadersData,
                backgroundColor: [
                'rgba(255, 206, 86, 0.4)',
                'rgba(78, 205, 196, 0.4)',
                'rgba(255, 107, 107, 0.4)',
                ],
                borderColor: [
                'rgba(255, 206, 86, 1)',
                'rgba(78, 205, 196, 1)',
                'rgba(255, 107, 107, 1)',
                ] 
            }],
            labels: ['Managed By Leaders', 'No Leaders Assigned']
        },
        options: {}
    });

    // Villages for farmers
    var villagesData = {{ villages_data|safe }}
    var villagesLabels = {{ villages_labels|safe }}


    var ctxVillages = document.getElementById('villages').getContext('2d');
    var villages = new Chart(ctxVillages, {
        type: 'pie',
        data: {
            datasets: [{
                data: villagesData,
                backgroundColor: [
                'rgba(255, 206, 86, 0.4)',
                'rgba(78, 205, 196, 0.4)',
                'rgba(255, 107, 107, 0.4)',
                'rgba(255, 99, 132, 0.4)',
                'rgba(54, 162, 235, 0.4)',
                'rgba(255, 206, 86, 0.4)',
                'rgba(75, 192, 192, 0.4)'
                ],
                borderColor: [
                'rgba(255, 206, 86, 1)',
                'rgba(78, 205, 196, 1)',
                'rgba(255, 107, 107, 1)',
                'rgba(255, 99, 132, 1)',
                'rgba(54, 162, 235, 1)',
                'rgba(255, 206, 86, 1)',
                'rgba(75, 192, 192, 1)',
                ] 
            }],
            labels: villagesLabels
        },
        options: {}
    });

        // For the visualization of engagement of farmers
    var farmerEngagementData = {{ farmer_engagement_data|safe }};

    var smartphoneFarmerEngagement = farmerEngagementData[0];
    var featurephoneFarmerEngagement = farmerEngagementData[1]; 
    var nophoneFarmerEngagement = farmerEngagementData[2];

    var months = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];

    var ctxFarmerEngagement = document.getElementById('farmerEngagement').getContext('2d');
	var farmerEngagement = new Chart(ctxFarmerEngagement, {
        type: 'line',
        data: {
            labels: months,
            datasets: [{
                label:[smartphoneFarmerEngagement.label],
                backgroundColor: ['rgba(255, 206, 86, 0.2)'],
                borderColor: ['rgba(255, 206, 86, 1)'],
                data: smartphoneFarmerEngagement.data,
                fill: false
            },
            {
                label:[featurephoneFarmerEngagement.label],
                backgroundColor: ['rgba(78, 205, 196, 0.2)',],
                borderColor: ['rgba(78, 205, 196, 1)',],
                data: featurephoneFarmerEngagement.data,
                fill: false
            },
            {
                label:[nophoneFarmerEngagement.label],
                backgroundColor: ['rgba(54, 162, 235, 0.2)',],
                borderColor: ['rgba(54, 162, 235, 1)',],
                data: nophoneFarmerEngagement.data,
                fill: false
            }]
        },
        options: {
            responsive: true,
            title: {
                display: true,
                text: 'Percentage Engagement of Farmers'
            },
            tooltips: {
                mode: 'index',
                intersect: false,
            },
            hover: {
                mode: 'nearest',
                intersect: true
            },
            scales: {
                xAxes: [{
                    display: true,
                    scaleLabel: {
                        display: true,
                        labelString: 'Month'
                    }
                }],
                yAxes: [{
                    display: true,
                    scaleLabel: {
                        display: true,
                        labelString: 'Value'
                    },
                    ticks: {max:100, min:0}
                }]
            }
        }
    });

    // Crops by farmers
    var cropsData = {{ crops_data|safe }}
    var cropsLabels = {{ crops_labels|safe }}

    var ctxCrops = document.getElementById('crops').getContext('2d');
    var crops = new Chart(ctxCrops, {
        type: 'pie',
        data: {
            datasets: [{
                data: cropsData,
                backgroundColor: [
                'rgba(255, 206, 86, 0.4)',
                'rgba(78, 205, 196, 0.4)',
                'rgba(255, 107, 107, 0.4)',
                'rgba(255, 99, 132, 0.4)',
                'rgba(54, 162, 235, 0.4)',
                'rgba(255, 206, 86, 0.4)',
                'rgba(75, 192, 192, 0.4)'
                ],
                borderColor: [
                'rgba(255, 206, 86, 1)',
                'rgba(78, 205, 196, 1)',
                'rgba(255, 107, 107, 1)',
                'rgba(255, 99, 132, 1)',
                'rgba(54, 162, 235, 1)',
                'rgba(255, 206, 86, 1)',
                'rgba(75, 192, 192, 1)',
                ] 
            }],
            labels: cropsLabels
        },
        options: {}
    });


    // Production By Crop
    var cropByYears = {{ crops_by_years_data|safe }};

    var crops = [];
    for(let i = 0; i < cropByYears.length; i++){
        crops.push(cropByYears[i].name);
    }

    var cropData = cropByYears[0].data;
    var cropYears = cropByYears[0].years;

    var ctxProductionByCrop = document.getElementById('productionByCrop').getContext('2d');
    var productionByCrop = new Chart(ctxProductionByCrop, {
        type: 'bar',
        data: {
        labels: cropYears,
        datasets: [{
            label: 'Crop Production By Year (In Quintals)',
            data: cropData,
            backgroundColor: [
                'rgba(255, 206, 86, 0.2)',
                'rgba(78, 205, 196, 0.2)',
                'rgba(255, 107, 107, 0.2)',
                'rgba(255, 99, 132, 0.2)',
                'rgba(54, 162, 235, 0.2)',
                'rgba(255, 206, 86, 0.2)',
                'rgba(75, 192, 192, 0.2)'
            ],
            borderColor: [
                'rgba(255, 206, 86, 1)',
                'rgba(78, 205, 196, 1)',
                'rgba(255, 107, 107, 1)',
                'rgba(255, 99, 132, 1)',
                'rgba(54, 162, 235, 1)',
                'rgba(255, 206, 86, 1)',
                'rgba(75, 192, 192, 1)'
            ],
            borderWidth: 1
        }]
    },
        options: {
             scales: {
            yAxes: [{
                ticks: {
                    beginAtZero: true
                }
            }]
        }
        }
    });

    // For selecting the crop from the dropdown menu
    document.querySelector('#cropSelector').addEventListener('change', function() {
        var cropName = document.querySelector('#cropSelector').value;
        var cropIndex = crops.indexOf(cropName);
        cropData = cropByYears[cropIndex].data;
        cropYears = cropByYears[cropIndex].years;
        productionByCrop.data.datasets[0].data = cropData;
        productionByCrop.data.labels = cropYears; 
        productionByCrop.update();
    });



    // Amount Per Crop
    var cropByAmount = {{ crops_profits_by_years_data|safe }};

    var cropsNames = [];
    for(let i = 0; i < cropByAmount.length; i++){
        cropsNames.push(cropByAmount[i].name);
    }

    var cropPriceData = cropByAmount[0].data;
    var cropPriceYears = cropByAmount[0].years;

    var ctxAmountPerCrop = document.getElementById('amountPerCrop').getContext('2d');
    var amountPerCrop = new Chart(ctxAmountPerCrop, {
        type: 'bar',
        data: {
        labels: cropPriceYears,
        datasets: [{
            label: 'Selling Price For Every Crop By Year',
            data: cropPriceData,
            backgroundColor: [
                'rgba(255, 206, 86, 0.2)',
                'rgba(78, 205, 196, 0.2)',
                'rgba(255, 107, 107, 0.2)',
                'rgba(255, 99, 132, 0.2)',
                'rgba(54, 162, 235, 0.2)',
                'rgba(255, 206, 86, 0.2)',
                'rgba(75, 192, 192, 0.2)'
            ],
            borderColor: [
                'rgba(255, 206, 86, 1)',
                'rgba(78, 205, 196, 1)',
                'rgba(255, 107, 107, 1)',
                'rgba(255, 99, 132, 1)',
                'rgba(54, 162, 235, 1)',
                'rgba(255, 206, 86, 1)',
                'rgba(75, 192, 192, 1)'
            ],
            borderWidth: 1
        }]
    },
        options: {
             scales: {
            yAxes: [{
                ticks: {
                    beginAtZero: true
                }
            }]
        }
        }
    });

    // For selecting the crop from the dropdown menu
    document.querySelector('#cropPriceSelector').addEventListener('change', function() {
        var cropName = document.querySelector('#cropPriceSelector').value;
        var cropIndex = cropsNames.indexOf(cropName);
        cropPriceData = cropByAmount[cropIndex].data;
        cropPriceYears = cropByAmount[cropIndex].years;
        amountPerCrop.data.datasets[0].data = cropPriceData;
        amountPerCrop.data.labels = cropPriceYears; 
        amountPerCrop.update();
    });





    // For visualization of Profits
    var profitByYearsData = {{ profit_by_years_data|safe }};

    var years = [];
    for(let j = 0; j < profitByYearsData.length; j++){
        years.push(profitByYearsData[j].year);
    }

    var profitsData = profitByYearsData[0].data;

    var ctxProfitsByYear = document.getElementById('profitsByYear').getContext('2d');
	var profitsByYear = new Chart(ctxProfitsByYear, {
        type: 'line',
        data: {
            labels: ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'],
            datasets: [{
                label:['Profits'],
                backgroundColor: ['rgba(255, 206, 86, 0.2)'],
                borderColor: ['rgba(255, 206, 86, 1)'],
                data: profitsData,
                fill: true,
            }]
        },
        options: {
            responsive: true,
            title: {
                display: true,
                text: 'Profits in Rupees'

            },
            tooltips: {
                mode: 'index',
                intersect: false,
            },
            hover: {
                mode: 'nearest',
                intersect: true
            },
            scales: {
                xAxes: [{
                    display: true,
                    scaleLabel: {
                        display: true,
                        labelString: 'Month'
                    }
                }],
                yAxes: [{
                    display: true,
                    scaleLabel: {
                        display: true,
                        labelString: 'Value'
                    },
                    ticks: {min:0}
                }]
            }
        }
    });

    // For selecting the year from the dropdown menu
    document.querySelector('#yearSelector').addEventListener('change', function() {
        var yearNumber = document.querySelector('#yearSelector').value;
        var yearIndex = years.indexOf(yearNumber);
        profitsData = profitByYearsData[yearIndex].data;
        profitsByYear.data.datasets[0].data = profitsData; 
        profitsByYear.update();
    });



  </script>
<script>
 $(document).ready(function() {

$('.counter').each(function () {
$(this).prop('Counter',0).animate({
Counter: $(this).text()
}, {
duration: 4000,
easing: 'swing',
step: function (now) {
$(this).text(Math.ceil(now));
}
});
});

});

</script>
</body>

</html>
