{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>Meetings</title>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.11.2/css/all.css">
    <!-- Bootstrap core CSS -->
    <link href="{% static 'css/bootstrap.min.css' %}" rel="stylesheet">
    <!-- Material Design Bootstrap -->
    <link href="{% static 'css/mdb.min.css' %}" rel="stylesheet">
    <!--  custom styles  -->
    <link href="{% static 'css/style.min.css' %}" rel="stylesheet">
    <!-- Charts Js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.min.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.min.css" crossorigin="anonymous"></link>
    <style type="text/css">

      html,
      body,
      header,
      .carousel {
        height: 60vh;
      }

      @media (max-width: 740px) {
        html,
        body,
        header,
        .carousel {
          height: 100vh;
        }
      }

      @media (min-width: 800px) and (max-width: 850px) {
        html,
        body,
        header,
        .carousel {
          height: 100vh;
        }
      }

      @media (min-width: 800px) and (max-width: 850px) {
              .navbar:not(.top-nav-collapse) {
                  background:#295e10!important;
              }
          }

      input.marker {
        background-color: #4caf50;
        width: 20px;
        height: 20px;
      }

      #pushButton {
        background-color: white;
        border: 1px solid #2a9d8f;
        color: #2a9d8f;
        border-radius: 0.2rem;
        font-size: 1.4rem;
        padding: 0.2rem 1rem;
        transition: all 0.5s;
      }

      #pushButton:hover {
        background-color: #2a9d8f;
        border: 1px solid white;
        color: white;
      }

      #pushButton:focus, #pushButton:active, #pushButton:selected {
        border: 1px solid #d62828;
      }

      input.selectAll {
        width: 16px;
        height: 16px;
      }

    .card:hover {
        cursor: pointer;
    }

    </style>
</head>

<body>

  <!-- Navbar -->
  <nav class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar">
    <div class="container">

      <!-- Brand -->
      <a class="navbar-brand" href="{% url 'home' %}">
        <strong>FPO PORTAL</strong>
      </a>

      <!-- Collapse -->
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
        aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>

      <!-- Links -->
      <div class="collapse navbar-collapse" id="navbarSupportedContent">

        <!-- Left -->
        <ul class="navbar-nav mr-auto">
          <li class="nav-item">
            <a class="nav-link" href="{% url 'home' %}">Home
              <span class="sr-only">(current)</span>
            </a>
          </li>
          <li class="nav-item active">
            <a class="nav-link" href="{% url 'meetings' %}" >Meetings</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="{% url 'plans' %}">Plans</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="{% url 'govtschemes' %}" >Government Schemes</a>
          </li>
             <li class="nav-item">
            <a class="nav-link" href="{% url 'produce' %}" >Production</a>
          </li>
            <li class="nav-item">
                <a class="nav-link" href="{% url 'FPOLedger'%}">Ledger</a>
            </li>
        </ul>

        <!-- Right -->
       <ul class="navbar-nav nav-flex-icons">
            <li class="nav-item">
            <a href="{% url 'add_user' %}" class="nav-link" data-toggle="tooltip" title="Add New User">
             <i class="fas fa-user-plus"></i>
            </a>
          </li>
             <li class="nav-item">
            <a href="{% url 'transaction'%}" class="nav-link" data-toggle="tooltip" title="Transactions">
             <i class="fas fa-rupee-sign"></i>
            </a>
          </li>
          <li class="nav-item">
            <a href="{% url 'orders' %}" class="nav-link" data-toggle="tooltip" title="Orders">
             <i class="fas fa-shopping-cart"></i>
            </a>
          </li>
             <li class="nav-item">
            <a href="{% url 'products' %}" class="nav-link" data-toggle="tooltip" title="Products">
             <i class="fas fa-shopping-basket"></i>
            </a>
          </li>
          <li class="nav-item">
            <a href="{% url 'fpo_statistics' %}" class="nav-link" data-toggle="tooltip" title="Statistics">
             <i class="fas fa-chart-bar"></i>
            </a>
          </li>
          <li class="nav-item">
            <a href="{% url 'members' %}" class="nav-link border border-light rounded"
             >
              <i class="fas fa-user"></i>Members
            </a>
          </li>
		  <li class="nav-item">
            <a class="nav-link" href="{% url 'login' %}" >Logout</a>
          </li>


        </ul>

      </div>

    </div>
  </nav>
  <!-- Navbar -->



  <!--Main layout-->
<main style="padding-top:10%">
    <div style="width: 90%; margin: auto;">
    <div style="text-align: center;">
        <i class="far fa-list-alt fa-4x green-text mb-3" style="opacity: 0.2"></i>
    </div>
    <h1 style="text-align: center; margin-bottom: 1.6rem; color: #4caf50">Redeem Tokens</h1>
        <hr style="margin: 2rem auto; width: 6rem; border: 2px solid lightgray; border-radius: 20rem;">
        <div class="text-right">
         <button id="pushButton">Redeem</button>
        </div>
        <h1 class="green-text mt-4 mb-2">Farmers</h1>
        <hr style="margin: 0; width: 4rem; border: 2px solid #4caf50; border-radius: 20rem;">
        <div class="row mt-4">
            {% for token in farmers %}
            <div class="col-xl-2 col-lg-3 col-md-4 mb-4">
                <div class="card">
                    <div class="card-body">
                        <h3 class="float-right" style="color: #e76f51">{{token.number}}</h3>
                        <h5 class="card-title green-text">{{token.farmer}}</h5>
                        <h6 class="card-subtitle mb-2 text-muted">{{token.locality}}</h6>
                        <a class="card-link">
                          <input type="checkbox" class="marker mt-2" name="id" value="{{token.id}}">
                        </a>
                        <a class="card-link">
                            {% if token.smartphone_type == "Smartphone" %}
                            <i class="fas fa-mobile fa-2x green-text float-right" style="color: gray;"></i>
                            {% elif token.smartphone_type == "Featurephone" %}
                            <i class="fas fa-phone fa-2x green-text float-right" style="color: gray;"></i>
                            {% else %}
                            <i class="fas fa-phone-slash fa-2x green-text float-right" style="color: gray;"></i>
                            {% endif %}
                        </a>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</main>
  <!--Main layout-->

  <!--Footer-->
  <footer class="page-footer text-center font-small mt-4 wow fadeIn" >



    <!--Copyright-->
    <div class="footer-copyright py-3">
      Â© 2020 Copyright:
  Rural Caravan
    </div>
    <!--/.Copyright-->

  </footer>
  <!--/.Footer-->

    <!-- SCRIPTS -->
    <!-- JQuery -->
    <script type="text/javascript" src="{% static 'js/jquery-3.4.1.min.js' %}"></script>
    <!-- Bootstrap tooltips -->
    <script type="text/javascript" src="{% static 'js/popper.min.js' %}"></script>
    <!-- Bootstrap core JavaScript -->
    <script type="text/javascript" src="{% static 'js/bootstrap.min.js' %}"></script>
    <!-- MDB core JavaScript -->
    <script type="text/javascript" src="{% static 'js/mdb.min.js' %}"></script>
      <!-- Initializations -->
  <script type="text/javascript">
    // Animations initialization
    //new WOW().init();

    
    // For getting the inputs
    document.querySelector('#pushButton').addEventListener('click', function() {
        var inputs = document.querySelectorAll('.marker');
        selected_inputs = [];
        for(let i = 0; i < inputs.length; i++){
          if(inputs[i].checked){
            selected_inputs.push(inputs[i].value);
          }
        }
        
        let data = {
                "token_ids": selected_inputs
            }
        let url = `${window.location.origin}/fpo/mark_redeemed/`;
            function getCookie(name) {
                let cookieValue = null;
                if (document.cookie && document.cookie !== '') {
                    const cookies = document.cookie.split(';');
                    for (let i = 0; i < cookies.length; i++) {
                        const cookie = cookies[i].trim();
                        // Does this cookie string begin with the name we want?
                        if (cookie.substring(0, name.length + 1) === (name + '=')) {
                            cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                            break;
                        }
                    }
                }
                return cookieValue;
            }
            const csrftoken = getCookie('csrftoken');
            
            const json_data = JSON.stringify(data);

            const headers = {
                'Accept': 'application/json',
                'Content-Type': 'application/json',
                "X-CSRFToken": csrftoken
            }
            
            fetch(url, {method: 'post', headers: headers, body: json_data})
                .then(function(response) {
                    if(response.status===200){
                        for(let i = 0; i < inputs.length; i++){
                          if(inputs[i].checked){
                            inputs[i].parentNode.parentNode.parentNode.parentNode.remove();
                          }
                        }
                        response.json().then(function(data){
                            console.log(data);
                        })
                    }
                })
                .catch(function(err) {
                    console.log('The errror is', err);
                });




    });


    // For easier card selection
    var cards = document.querySelectorAll('.card');
    for(let i = 0; i < cards.length; i++){
        cards[i].addEventListener('click', function() {
            cards[i].querySelector('input.marker').checked = !cards[i].querySelector('input.marker').checked;
        });
    }

  </script>
</body>

</html>
